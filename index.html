<html>
<head>
<script src="core.js"></script>
<script src="mmu.js"></script>
<script src="io.js"></script>
<script src="video.js"></script>
<script src="irq.js"></script>

<script src="xhr.js"></script>
<script src="console.js"></script>
<link href="console.css" rel="stylesheet">
<script>
function runTest(r) {
	rom = mmu.loadRom(r, true);
	gbaCon.log("ROM loaded: " + rom.title + " [" + rom.code + "] (" + r.byteLength + " bytes)");
}

var core = new ARMCore();
var mmu = new GameBoyAdvanceMMU();
var irq = new GameBoyAdvanceInterruptHandler();
var io = new GameBoyAdvanceIO();
var video = new GameBoyAdvanceVideo();
var rom = null;
var gbaCon;
mmu.setIO(io);
io.setVideo(video);
io.setCPU(core);
irq.addIrqProvider(video);
core.resetCPU(0x08000000, mmu, irq, io);
window.onload = function() {
	var canvas = document.getElementById('screen');
	video.setCanvas(canvas);

	gbaCon = new Console(core);
	gbaCon.log("Logging begun!");
	loadRom('test.rom', runTest);
};
</script>
</head>
<body>
<section id="top">
	<ul id="console"></ul>
	<section id="main">
		<section id="display">
			<canvas id="screen" width="240" height="160"></canvas>
		</section>
		<section id="controls">
			<button onclick="gbaCon.step()">Step</button>
			<button onclick="gbaCon.runVisible()">Run slowly</button>
			<button onclick="gbaCon.run()">Run quickly</button>
			<button onclick="gbaCon.pause()">Pause</button>
		</section>
		<section id="registers">
			<div>
				<h3>GPRs</h3>
				<ol id="gprs">
					<li id="r0">0x00000000</li>
					<li id="r1">0x00000000</li>
					<li id="r2">0x00000000</li>
					<li id="r3">0x00000000</li>
					<li id="r4">0x00000000</li>
					<li id="r5">0x00000000</li>
					<li id="r6">0x00000000</li>
					<li id="r7">0x00000000</li>
					<li id="r8">0x00000000</li>
					<li id="r9">0x00000000</li>
					<li id="r10">0x00000000</li>
					<li id="r11">0x00000000</li>
					<li id="r12">0x00000000</li>
					<li id="r13">0x00000000</li>
					<li id="r14">0x00000000</li>
					<li id="r15">0x00000000</li>
				</ol>
			</div>
			<div>
				<h3>Status bits</h3>
				<ol id="psr">
					<li id="cpsrN">N</li>
					<li id="cpsrZ">Z</li>
					<li id="cpsrC">C</li>
					<li id="cpsrV">V</li>
					<li id="cpsrI">I</li>
					<li id="cpsrT">T</li>
					<li>Mode: <span id="mode">SYSTEM</span></li>
				</ol>
			</div>
		</section>
	</section>
	<ul id="memory"></ul>
</section>
</body>
</html>
